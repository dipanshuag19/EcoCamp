<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EcoCamp — A Greener Tommorow!</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>

    :root {
        --primary-color: #3b82f6; --primary-hover: #2563eb; --bg-dark: #0f172a; --bg-light: #1e293b; --text-color: #f1f5f9; --text-muted: #94a3b8; --border-color: rgba(148,163,184,0.2); --success-color: #22c55e; --radius: 12px; --max-width: 1200px; --ease: cubic-bezier(.2,.9,.3,1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body { font-family: 'Inter',sans-serif; background: var(--bg-dark); color: var(--text-color); -webkit-font-smoothing: antialiased; -moz-osx-smoothing: grayscale; line-height: 1.6; }
    .navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(15,23,42,0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); padding: 0 1rem; }
    .nav-inner { display: flex; align-items: center; justify-content: space-between; max-width: var(--max-width); margin: 0 auto; height: 70px; }
    .brand { display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 20px; color: var(--text-color); text-decoration: none; }
    .logo { width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg,var(--primary-color),#60a5fa); display: flex; align-items: center; justify-content: center; font-weight: 800; color: #fff; box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
    .brand-text div:first-child { font-size: 16px; }
    .brand-text div:last-child { font-size: 12px; color: var(--text-muted); font-weight: 500; }
    nav { display: flex; align-items: center; gap: .5rem; }
    .navlink { text-decoration: none; color: var(--text-muted); padding: 8px 12px; border-radius: 8px; transition: color .2s,background .2s; font-weight: 600; }
    .navlink:hover { color: var(--text-color); background: rgba(255,255,255,0.05); }
    .navlink.active { color: var(--primary-color); background: rgba(59,130,246,0.1); }
    .cta { background: var(--primary-color); color: #fff; border: none; padding: 10px 16px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: background .2s var(--ease),transform .2s var(--ease); margin-left: 1rem; }
    .cta:hover { background: var(--primary-hover); transform: translateY(-2px); }
    .menu-toggle { display: none; background: none; border: none; color: var(--text-color); font-size: 24px; cursor: pointer; }
    section { max-width: var(--max-width); margin: 0 auto; padding: 100px 1rem 40px; display: none; }
    section.active { display: block; }
    h1, h2, h3, h4 { color: var(--text-color); margin-bottom: 1rem; }
    p { color: var(--text-muted); margin-bottom: 1rem; }
    .home-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: center; }
    .home-hero h1 { font-size: 2.5rem; line-height: 1.2; }
    #ndhome { font-size: 1.2rem; font-style: italic; padding: 2rem; border-left: 3px solid var(--primary-color); background: var(--bg-light); border-radius: var(--radius); text-align: center; }
    .account-container { display: flex; flex-direction: column; align-items: center; gap: 2rem; padding: 2rem; background: var(--bg-light); border-radius: var(--radius); }
    .toggle-buttons { display: flex; gap: 1rem; background: var(--bg-dark); padding: 8px; border-radius: 8px; }
    .toggle-buttons button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 6px; background: none; color: var(--text-muted); font-weight: 600; transition: .2s; }
    .toggle-buttons button.active, .toggle-buttons button:hover { background: var(--primary-color); color: #fff; }
    .auth-form { display: none; flex-direction: column; gap: 1rem; width: 100%; max-width: 350px; }
    .auth-form.active { display: flex; }
    .form-group { position: relative; margin-bottom: 1rem; }
    .form-group .toggle-password { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-muted); }
    .otp-group { display: flex; gap: .5rem; align-items: center; }
    .otp-group input { flex-grow: 1; }
    .otp-btn { padding: 10px 15px; font-size: .9rem; flex-shrink: 0; background: var(--primary-color); color: #fff; border: none; border-radius: 8px; cursor: pointer; transition: background .2s,opacity .2s; }
    .otp-btn:hover { background: var(--primary-hover); }
    .otp-btn:disabled { background: var(--text-muted); opacity: .7; cursor: not-allowed; }
    #contact input, #contact textarea { width: 100%; padding: 10px 12px; border: 1px solid #2d3748; border-radius: 6px; background: #1e293b; color: #f1f5f9; }
    /* Unified placeholder color for all inputs and textareas */
    input::placeholder, textarea::placeholder, select::placeholder {
        color: #b0b8c9 !important;
        opacity: 1;
    }
    #contactForm { max-width: 600px; margin: 0 auto; }
    #contact input:focus, #contact textarea:focus { border-color: #3b82f6; outline: none; }
    .campaign-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 2rem; }
    .search-controls { display: flex; gap: .5rem; }
    .campaign-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(300px,1fr)); gap: 1.5rem; }
    .campaign-card { background: var(--bg-light); border-radius: var(--radius); padding: 1.5rem; border: 1px solid var(--border-color); transition: transform .2s,box-shadow .2s; position: relative; display: flex; flex-direction: column; }
    .campaign-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    .campaign-card h4 { color: var(--text-color); font-size: 1.25rem; }
    .campaign-card p { flex-grow: 1; font-size: .9rem; }
    .card-footer { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); }
    .campaign-tag { display: inline-block; background: rgba(59,130,246,0.1); color: var(--primary-color); padding: 4px 10px; border-radius: 16px; font-size: .8rem; font-weight: 600; text-transform: uppercase; }
    .campaign-id { color: var(--text-muted); font-size: .75rem; font-weight: bold; position: absolute; top: 1rem; right: 1rem; }
    .delete-btn { background: #ef4444; color: #fff; border: none; padding: 6px 12px; font-size: .8rem; border-radius: 6px; cursor: pointer; margin-top: 1rem; transition: background .2s; }
    .delete-btn:hover { background: #dc2626; }
    .form-container { max-width: 800px; margin: 0 auto; background: var(--bg-light); padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border-color); }
    .form-container h1 { text-align: center; color: var(--text-color); }
    .form-container p.intro { text-align: center; max-width: 600px; margin: 0 auto 2rem; }
    .form-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; }
    .form input, .form select, .form textarea, .auth-form input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-dark); color: var(--text-color); outline: none; transition: border-color .2s,box-shadow .2s; font-size: 1rem; }
    .form input:focus, .form select:focus, .form textarea:focus, .auth-form input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(59,130,246,0.3); }
    .form select option { background: var(--bg-dark); color: var(--text-color); }
    .form-group label { display: block; margin-bottom: .5rem; font-weight: 600; font-size: .9rem; color: var(--text-muted); }
    .form-buttons { display: flex; gap: 1rem; margin-top: 1.5rem; }
    .submit-btn, .reset-btn { flex: 1; padding: 12px; font-size: 1rem; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; transition: .2s; }
    .submit-btn:hover:not(:disabled) { background: var(--primary-hover); }
    .submit-btn:disabled { background: var(--text-muted); opacity: .7; cursor: not-allowed; }
    .reset-btn { background: var(--bg-light); border: 1px solid var(--border-color); color: var(--text-color); }
    .reset-btn:hover { background: var(--bg-dark); }
    .form-row label { margin-bottom: 0.3rem; }
    .form-row-horizontal { display: flex; gap: 1rem; }
    .form-row-horizontal .form-half { flex: 1 1 0; display: flex; flex-direction: column; }
    .form-row input[type="date"], .form-row input[type="time"] {min-width: 120px; margin-bottom: 0.5rem; }
    .form-sidebar { background: var(--bg-dark); padding: 1.5rem; border-radius: var(--radius); }
    .campaign-category-wrapper { margin-bottom: 3rem; }
    .view-all-btn { display: inline-block; margin-top: 1rem; margin-left: 0; }
    #backToAllBtn { display: none; margin-bottom: 2rem; margin-left: 0; }
    .campaign-card.hidden { display: none; }
    @media (max-width: 768px) {
        nav { display: none; position: absolute; top: 70px; left: 0; right: 0; background: var(--bg-light); flex-direction: column; align-items: stretch; padding: 1rem; border-bottom: 1px solid var(--border-color); }
        nav.active { display: flex; }
        .cta { margin-left: 0; width: 100%; text-align: center; }
        .menu-toggle { display: block; }
        .home-layout, .form-layout { grid-template-columns: 1fr; }
        .home-hero h1 { font-size: 2rem; }
    }

</style>
</head>
<body>

<header class="navbar">
    <div class="nav-inner">
        <a href="#" class="brand" title="EcoCamp">
            <div class="logo">EC</div>
            <div class="brand-text">
                <div>EcoCamp</div>
                <div>A Greener Tomorrow!</div>
            </div>
        </a>
        <button class="menu-toggle" id="menuToggle" aria-label="Toggle navigation">
            &#9776; </button>
        <nav>
            <a class="navlink active" href="#home" data-section="home">Home</a>
            <a class="navlink" href="#campaigns" data-section="campaigns">Campaigns</a>
            <a class="navlink" href="#add" data-section="add">Add</a>
            <a class="navlink" href="#contact" data-section="contact">Contact</a>
            <button class="cta" id="quickAddBtnEco">+ New Campaign</button>
        </nav>
    </div>
</header>

<div class="language-selector" style="position: fixed; top: 10px; right: 10px; z-index: 1000;">
    <select id="languageDropdown" style="padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-light); color: var(--text-color);">
    <option value="" disabled selected>{{ user_language }} </option>
    <option value="as">অসমীয়া (Assamese)</option>
    <option value="bn">বাংলা (Bengali)</option>
    <option value="en">English</option>
    <option value="gu">ગુજરાતી (Gujarati)</option>
    <option value="hi">हिन्दी (Hindi)</option>
    <option value="kn">ಕನ್ನಡ (Kannada)</option>
    <option value="ml">മലയാളം (Malayalam)</option>
    <option value="mr">मराठी (Marathi)</option>
    <option value="pa">ਪੰਜਾਬੀ (Punjabi)</option>
    <option value="ta">தமிழ் (Tamil)</option>
    <option value="te">తెలుగు (Telugu)</option>
    <option value="ur">اردو (Urdu)</option>
    </select>
</div>

<main>
    <section id="home" class="active">
        <div class="home-layout">
            <div class="home-hero">
                <h1>Hey {{ fullname.split()[0] }}, Welcome to EcoCamp!</h1>
                <p> {{ translate("Join hands to protect our green planet. Start a campaign, plant hope for a brighter, cleaner tomorrow.") }}</p>
                <div id="ndhome"></div>
                <script>
                fetch("{{ url_for('static', filename='quotes.txt') }}").then(r=>r.text()).then(t=>{
                    const quotes = t.split('\n').filter(Boolean);
                    const quoteEl = document.getElementById('ndhome');
                    const setQuote = () => {
                        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                        quoteEl.innerText = `Active Campaigns: {{ edetailslist|length }}\n\n“${randomQuote}”`;
                    };
                    setQuote();
                    setInterval(setQuote, 6000);
                });
                </script>
            </div>
            
            <div class="account-container">
                {% if c_user == "None" %}
                    <div class="toggle-buttons">
                        <button id="login-tab-btn" class="active">Login</button>
                        <button id="signup-tab-btn">Sign Up</button>
                    </div>

                    <form class="auth-form active" id="loginpage">
                        <div class="form-group">
                            <input type="text" name="loginusername" placeholder="Username or Email" required />
                        </div>
                        <div class="form-group">
                            <input type="password" name="loginpassword" id="loginpassword" placeholder="Password" required/>
                            <span class="toggle-password" onclick="togglePasswordVisibility('loginpassword')">👁️</span>
                        </div>
                        <button type="submit" class="submit-btn">Login</button>
                    </form>
                    
                    <form class="auth-form" id="signuppage">
                        <div class="form-group"><input type="text" name="nameofuser" placeholder="Full Name" maxlength="24" required /></div>
                        <div class="form-group"><input type="text" name="username" placeholder="Username" maxlength="20" required /></div>
                        <div class="form-group otp-group">
                           <input type="email" name="email" id="email" placeholder="Email" required />
                           <button type="button" id="sendOtpBtn" class="otp-btn">Send OTP</button>
                        </div>
                        <div class="form-group"><input type="number" name="signupotp" placeholder="Enter OTP" oninput="this.value=this.value.slice(0,4)" required /></div>
                        <div class="form-group">
                            <input type="password" name="password" id="signup_password" placeholder="Password" required />
                             <span class="toggle-password" onclick="togglePasswordVisibility('signup_password')">👁️</span>
                        </div>
                        <div class="form-group">
                            <input type="password" name="cpassword" id="signup_cpassword" placeholder="Confirm Password" required />
                             <span class="toggle-password" onclick="togglePasswordVisibility('signup_cpassword')">👁️</span>
                        </div>
                        <button type="submit" class="submit-btn">Sign Up</button>
                    </form>
                    {% else %}
                    <h3>Welcome, {{ fullname }}!</h3>
                    <p>Username: {{ c_user }}</p>
                    <p>Email: {{ userdetails['email'] }}</p>
                    <p>Events by you: {{ userdetails['events'] }}</p>
                    <div class="form-buttons">
                        <button onclick="window.location.href='/logout';" class="reset-btn">Logout</button>
                        <button onclick="window.location.href='/clearsession';" class="delete-btn">Clear Session</button>
                    </div>
                {% endif %}
            </div>
        </div>
        {% if isadmin %}
            <h2>Pending Events</h2>
            <iframe src="/pendingevents" style="width: 100%; height: 300px; border: 1px solid var(--border-color); border-radius: var(--radius);"></iframe>
        {% endif %}
    </section>

    <section id="campaigns">
        <div class="campaign-header">
            <div>
                <h2>Campaigns</h2>
                <p>Find campaigns to join or create your own.</p>
            </div>
        </div>
        <button id="backToAllBtn" class="cta">Back to All Categories</button>

        {% set categories = {'Tree Plantation': treeplantation, 'Blood Donation': blooddonation, 'Cleanlines Drive': cleanlinesdrive} %}
        {% for category_name, events in categories.items() %}
            {% if events|length >= 1 %}
                <div class="campaign-category-wrapper" data-category-id="{{ category_name|replace(' ', '-')|lower }}">
                    <h3>{{ category_name }} ({{ events|length }})</h3>
                    <div class="campaign-grid">
                        {% for e in events %}
                            <div class="campaign-card {% if loop.index > 3 %}hidden{% endif %}">
                                <span class="campaign-id">#{{ e.eventid }}</span>
                                <h4>{{ e.eventname }}</h4>
                                <p>{{ e.description }}</p>
                                <p><b>From:</b> {{ e.eventdate|datetimeformat }} | {{ e.starttime }}<br><b>Till:</b> {{ e.enddate|datetimeformat }} | {{ e.endtime }}</p>
                                <p><b>Location:</b> {{ e.location }}</p>
                                <div class="card-footer">
                                    <span class="campaign-tag">{{ e.category }}</span>
                                    {% if e.username == c_user or isadmin %}
                                        <button onclick="asktodelete({{ e.eventid }})" class="delete-btn">Delete Event</button>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    {% if events|length > 3 %}
                        <button class="cta view-all-btn" data-category-id="{{ category_name|replace(' ', '-')|lower }}">View All</button>
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}
    </section>
    
    <section id="add">
        <div class="form-container">
            <h1>Create a New Campaign</h1>
            <p class="intro">
                Add details for your campaign below. Once approved, it will appear in the campaign list for everyone to see.
            </p>
            <div class="form-layout">
                <div class="form">
                    <form id="addEventForm">
                        <div class="form-group"><input type="text" value="{{fvalues['eventname']}}" name="eventname" placeholder="Campaign Name (Max 50)" maxlength="50" required /></div>
                        <div class="form-group"><input type="text" value="{{fvalues['location']}}" name="location" placeholder="Location (Max 30)" maxlength="30" required /></div>
                        <div class="form-group"><textarea name="description" placeholder="Description (Max 100)" maxlength="100" rows="3" required>{{fvalues['description']}}</textarea></div>
                        <div class="form-group">
                            <select name="category" required>
                                <option value="" disabled {% if not fvalues['category'] %}selected{% endif %}>Select a category</option>
                                <option value="Tree Plantation" {% if fvalues['category'] == 'Tree Plantation' %}selected{% endif %}>Tree Plantation</option>
                                <option value="Blood Donation" {% if fvalues['category'] == 'Blood Donation' %}selected{% endif %}>Blood Donation</option>
                                <option value="Cleanlines Drive" {% if fvalues['category'] == 'Cleanlines Drive' %}selected{% endif %}>Cleanlines Drive</option>
                            </select>
                        </div>
                        <div class="form-group form-row-horizontal">
                            <div class="form-half">
                                <label for="eventdate">Start Date</label>
                                <input id="eventdate" type="date" value="{{fvalues['eventdate']}}" name="eventdate" required />
                            </div>
                            <div class="form-half">
                                <label for="enddate">End Date</label>
                                <input id="enddate" type="date" value="{{fvalues['enddate']}}" name="enddate" required />
                            </div>
                        </div>
                        <div class="form-group form-row-horizontal">
                            <div class="form-half">
                                <label for="starttime">Start Time</label>
                                <input id="starttime" type="time" value="{{fvalues['starttime']}}" name="starttime" required />
                            </div>
                            <div class="form-half">
                                <label for="endtime">End Time</label>
                                <input id="endtime" type="time" value="{{fvalues['endtime']}}" name="endtime" required />
                            </div>
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="submit-btn">Submit Campaign</button>
                            <button type="reset" class="reset-btn">Reset</button>
                        </div>
                    </form>
                </div>
                <div class="form-sidebar">
                    <h3>Tips for Success</h3>
                    <ul>
                        <li>Use clear, concise titles.</li>
                        <li>Add the location or place id for clarity.</li>
                        <li>Choose the correct category.</li>
                        <li>Short descriptions work best!</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section id="contact">
        <div class="form-container">
            <h1>Contact Us</h1>
            <p class="intro">
                Have a question or feedback? Send us a message, and we’ll get back to you as soon as possible.
            </p>
            <form id="contactForm">
                {% if c_user == "None" %}
                    <div class="form-group"><input type="text" name="name" placeholder="Your Name" maxlength="40" required /></div>
                    <div class="form-group"><input type="email" name="email" placeholder="Your Email" maxlength="40" required /></div>
                {% else %}
                    <div class="form-group"><input type="text" name="name" value="{{ fullname }}" readonly /></div>
                    <div class="form-group"><input type="email" name="email" value="{{ userdetails['email'] }}" readonly /></div>
                {% endif %}
                <div class="form-group"><textarea name="message" placeholder="Write your message..." rows="5" required></textarea></div>
                <button type="submit" class="submit-btn" style="width:100%;">Send Message</button>
            </form>
        </div>
    </section>
</main>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Helpers ---
        const $ = s => document.querySelector(s);
        const $$ = s => document.querySelectorAll(s);
        window.asktodelete = id => confirm("Are you sure you want to delete this event? This action cannot be undone.") && (window.location.href = `deleteevent/${id}`);
        window.togglePasswordVisibility = id => {
            const f = $(`#${id}`);
            if (f) f.type = f.type === 'password' ? 'text' : 'password';
        };

        // --- Navigation ---
        const nav = $('nav');
        const showSection = id => {
            const target = id || 'home';
            $$('.navlink').forEach(l => l.classList.toggle('active', l.dataset.section === target));
            $$('main > section').forEach(s => s.classList.toggle('active', s.id === target));
            window.scrollTo(0, 0);
            nav.classList.remove('active');
        };
        document.body.addEventListener('click', e => {
            if (e.target.matches('.navlink')) {
                e.preventDefault();
                showSection(e.target.dataset.section);
                location.hash = e.target.dataset.section;
            }
            if (e.target.matches('#quickAddBtnEco')) showSection('add');
            if (e.target.matches('#menuToggle')) nav.classList.toggle('active');
        });
        showSection(location.hash.slice(1));
        window.addEventListener('hashchange', () => showSection(location.hash.slice(1)));

        // --- Form Submission Handler (with button disabling) ---
        const handleFormSubmit = async (form, callback) => {
            const btn = form.querySelector('button[type="submit"]');
            const originalBtnText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Processing...';
            try {
                const response = await fetch(form.dataset.url, { method: 'POST', body: new FormData(form) });
                const text = await response.text();
                alert(text);
                if (callback) callback(text);
            } catch (error) {
                alert('An error occurred. Please try again.');
                console.error(error);
            } finally {
                btn.disabled = false;
                btn.textContent = originalBtnText;
            }
        };

        // --- Event Listeners ---
        $('#loginpage')?.addEventListener('submit', e => {
            e.preventDefault(); e.target.dataset.url = '/login';
            handleFormSubmit(e.target, text => text.includes('Success') && location.reload());
        });
        $('#signuppage')?.addEventListener('submit', e => {
            e.preventDefault(); e.target.dataset.url = '/signup';
            handleFormSubmit(e.target, text => text.includes('Success') && location.reload());
        });
        $('#addEventForm')?.addEventListener('submit', e => {
            e.preventDefault(); e.target.dataset.url = '/addeventreq';
            handleFormSubmit(e.target, text => {
                if (text.includes('Please Login')) showSection('home');
                else if (text.includes('Registered')) location.reload();
            });
        });

        // --- Auth Tab Toggling ---
        $('.toggle-buttons')?.addEventListener('click', e => {
            if (e.target.tagName !== 'BUTTON') return;
            const isLogin = e.target.id === 'login-tab-btn';
            $('#login-tab-btn').classList.toggle('active', isLogin);
            $('#signup-tab-btn').classList.toggle('active', !isLogin);
            $('#loginpage').classList.toggle('active', isLogin);
            $('#signuppage').classList.toggle('active', !isLogin);
        });

        // --- OTP Sender ---
        $('#sendOtpBtn')?.addEventListener('click', async e => {
            const btn = e.target, emailEl = $("#email");
            if (!emailEl.checkValidity()) return alert("Please enter a valid email address.");
            btn.disabled = true; btn.textContent = "Sending...";
            const fd = new FormData(); fd.append('email', emailEl.value);
            try {
                const r = await fetch("/sendsignupotp", { method: "POST", body: fd });
                if (!r.ok) throw new Error(await r.text() || 'Failed to send OTP.');
                alert(`OTP sent to ${emailEl.value}! Please check your email or spam folder.`);
            } catch (err) { alert(err.message);
            } finally { setTimeout(() => { btn.disabled = false; btn.textContent = "Send OTP"; }, 5000); }
        });

        // --- Campaign View Toggling ---
        const campaignsSection = $('#campaigns');
        const backToAllBtn = $('#backToAllBtn');
        const allCategoryWrappers = campaignsSection.querySelectorAll('.campaign-category-wrapper');

        campaignsSection.addEventListener('click', (e) => {
            if (e.target.matches('.view-all-btn')) {
                const categoryIdToShow = e.target.dataset.categoryId;
                
                // Hide all category wrappers except the one we want to show
                allCategoryWrappers.forEach(wrapper => {
                    if (wrapper.dataset.categoryId === categoryIdToShow) {
                        wrapper.style.display = 'block';
                        // Show all hidden cards within this category
                        wrapper.querySelectorAll('.campaign-card.hidden').forEach(card => card.classList.remove('hidden'));
                    } else {
                        wrapper.style.display = 'none';
                    }
                });
                
                // Show the 'Back' button and scroll to top of section
                backToAllBtn.style.display = 'block';
                campaignsSection.scrollIntoView({ behavior: 'smooth' });
            }
        });

        backToAllBtn.addEventListener('click', () => {
            // Show all category wrappers again
            allCategoryWrappers.forEach((wrapper, index) => {
                wrapper.style.display = 'block';
                // Re-hide cards beyond the 3rd one
                wrapper.querySelectorAll('.campaign-card').forEach((card, cardIndex) => {
                    if (cardIndex >= 3) {
                        card.classList.add('hidden');
                    }
                });
            });

            // Hide the 'Back' button
            backToAllBtn.style.display = 'none';
        });
        
        // --- Save Draft ---
        $('#addEventForm')?.addEventListener('change', e => {
            const fd = new FormData();
            fd.append('field', e.target.name);
            fd.append('value', e.target.value);
            fetch('/save_draft', { method: 'POST', body: fd });
        });
    });
</script>

<script>
    document.getElementById('languageDropdown').addEventListener('change', function() {
        const selectedLanguage = this.value;
        window.location.href = `/set_language/${selectedLanguage}`;
        alert(`Language changed to: ${selectedLanguage}`);
    });
</script>

</body>
</html>
